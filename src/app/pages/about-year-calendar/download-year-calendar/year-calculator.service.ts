import { Injectable } from '@angular/core';

@Injectable({
  providedIn: 'root'
})
export class YearCalculatorService {

  // Місяці року
  months = [
    'Січень', 'Лютий', 'Березень', 'Квітень',
    'Травень', 'Червень', 'Липень', 'Серпень',
    'Вересень', 'Жовтень', 'Листопад', 'Грудень'
  ];

  // Сприятливі та несприятливі дні по місяцях
  monthPeriods = [
    { bad: [1, 13], good: [14, 31] }, // Січень
    { bad: null, good: [1, 29] },     // Лютий
    { bad: null, good: [1, 31] },     // Березень
    { bad: [14, 30], good: [1, 13] }, // Квітень
    { bad: [1, 13], good: [14, 31] }, // Травень
    { bad: [14, 30], good: [1, 13] }, // Червень
    { bad: [1, 31], good: null },     // Липень
    { bad: [1, 13], good: [14, 31] }, // Серпень
    { bad: [14, 30], good: [1, 13] }, // Вересень
    { bad: [1, 31], good: null },     // Жовтень
    { bad: [14, 30], good: [1, 13] }, // Листопад
    { bad: [14, 31], good: [1, 13] }  // Грудень
  ];

  // Відповідність літер числам сюцай
  syucaiMap: { [key: string]: number } = {
    A: 1, I: 1, J: 1, Q: 1, Y: 1,
    B: 2, K: 2, R: 2, S: 2,
    C: 3, L: 3, G: 3,
    D: 4, M: 4, T: 4,
    E: 5, H: 5, N: 5, X: 5,
    U: 6, V: 6, W: 6,
    O: 7, Z: 7,
    F: 8, P: 8
  };

  meanings: {
    [key: number]: {
      name: string,
      advice: string,
      explanation: string,
      example: string
    }
  } = {
      1: {
        name: "Популярність",
        advice: "Використовуй свій вплив мудро, не витрачай його на дрібниці.",
        explanation: "Число 1 пов’язане з увагою, якою людина користується у суспільстві.",
        example: "Тебе можуть часто обирати лідером у компанії чи на роботі."
      },
      2: {
        name: "Особисте благополуччя (для жінок – до заміжжя)",
        advice: "Дбай про свій внутрішній комфорт і гармонію з оточенням.",
        explanation: "Двійка символізує баланс у стосунках та добробут у повсякденному житті.",
        example: "Вміння створювати затишок вдома чи у спілкуванні."
      },
      3: {
        name: "Солідність",
        advice: "Розвивай відповідальність і вміння тримати слово.",
        explanation: "Трійка означає стабільність, вагомість та авторитет.",
        example: "Людина, до якої звертаються за порадою чи підтримкою."
      },
      4: {
        name: "Відчуженість",
        advice: "Навчися відкриватися людям та не ізолюватися.",
        explanation: "Число показує схильність до самотності або закритості.",
        example: "Коли замість спілкування обираєш саморефлексію."
      },
      5: {
        name: "Артистизм",
        advice: "Використовуй творчість для самовираження і допомоги іншим.",
        explanation: "П’ятірка уособлює талант, креативність і мистецькі здібності.",
        example: "Людина, що легко співає, малює чи виступає публічно."
      },
      6: {
        name: "Успіх (для жінок – до заміжжя)",
        advice: "Розвивай свої сильні сторони й використовуй можливості.",
        explanation: "Шістка вказує на досягнення, реалізацію і визнання.",
        example: "Отримання нагороди чи підвищення на роботі."
      },
      7: {
        name: "Виклик природі",
        advice: "Вчися приймати обставини, а не йти проти них.",
        explanation: "Сімка символізує конфлікт або перевірку характеру.",
        example: "Робота, що вимагає перевершити власні сили."
      },
      8: {
        name: "Постійна наполеглива праця",
        advice: "Тримайся стабільності й не кидай справу на півдорозі.",
        explanation: "Вісімка означає витривалість, терпіння і поступовий результат.",
        example: "Робота над довгим проєктом, що приносить плоди з часом."
      },
      9: {
        name: "Емоційна глибина",
        advice: "Дозволяй собі відчувати і ділитися цим з іншими.",
        explanation: "Дев’ятка вказує на чутливість, мудрість і глибину переживань.",
        example: "Людина, яка легко співпереживає чужим проблемам."
      }
    };


  consciousMeanings: {
    [key: number]: { name: string, explanation: string, advice: string, example: string }
  } = {
      1: {
        name: "Лідерство, активність",
        explanation: "Людина з числом свідомості 1 має сильний характер і здатність вести інших.",
        advice: "Використовуй свою активність для створення нових ідей.",
        example: "Приклад: керівник, новатор, підприємець."
      },
      2: {
        name: "Чутливість, дипломатичність",
        explanation: "Це число вказує на гармонійність у відносинах і здатність до співпраці.",
        advice: "Розвивай терпіння і емпатію у спілкуванні.",
        example: "Приклад: дипломат, сімейний радник."
      },
      3: {
        name: "Творчість, комунікабельність",
        explanation: "Трійка приносить артистизм, уяву й легкість у спілкуванні.",
        advice: "Займайся творчістю і використовуй силу слова.",
        example: "Приклад: актор, письменник, маркетолог."
      },
      4: {
        name: "Стабільність, дисципліна",
        explanation: "Число дає людині прагнення до порядку та практичності.",
        advice: "Будь послідовним і працюй системно.",
        example: "Приклад: будівельник, інженер, бухгалтер."
      },
      5: {
        name: "Свобода, пригоди",
        explanation: "П’ятірка — це енергія змін і прагнення до нового досвіду.",
        advice: "Не бійся ризикувати, але уникай хаосу.",
        example: "Приклад: мандрівник, блогер, журналіст."
      },
      6: {
        name: "Комфорт, гармонія",
        explanation: "Шістка несе відповідальність, любов і турботу.",
        advice: "Створюй гармонію у стосунках та вдома.",
        example: "Приклад: вчитель, психолог, дизайнер інтер’єрів."
      },
      7: {
        name: "Аналітичність, духовність",
        explanation: "Сімка пов’язана з пошуком істини і глибинним аналізом.",
        advice: "Приділяй увагу навчанню та саморозвитку.",
        example: "Приклад: дослідник, науковець, філософ."
      },
      8: {
        name: "Амбіції, успіх",
        explanation: "Вісімка символізує матеріальний добробут і кар’єрний ріст.",
        advice: "Використовуй силу для досягнення справедливості.",
        example: "Приклад: бізнесмен, управлінець."
      },
      9: {
        name: "Співчуття, глибина",
        explanation: "Дев’ятка приносить служіння іншим і духовну зрілість.",
        advice: "Будь корисним для суспільства і розвивай альтруїзм.",
        example: "Приклад: лікар, волонтер, наставник."
      }
    };

  missionMeanings: {
    [key: number]: { name: string, explanation: string, advice: string, example: string }
  } = {
      1: {
        name: "Ініціатива, лідерство",
        explanation: "Число 1 у місії символізує активність і здатність вести інших.",
        advice: "Будь впевненим у своїх рішеннях і проявляй лідерські якості.",
        example: "Приклад: керівник проєкту, організатор заходів."
      },
      2: {
        name: "Співпраця, дипломатія",
        explanation: "Двійка показує потребу в гармонії та взаєморозумінні.",
        advice: "Розвивай терпіння та вміння слухати інших.",
        example: "Приклад: дипломат, сімейний радник, переговорник."
      },
      3: {
        name: "Творчість, самовираження",
        explanation: "Трійка у місії символізує творчий потенціал та комунікабельність.",
        advice: "Використовуй креативність для вирішення завдань і спілкування.",
        example: "Приклад: письменник, актор, маркетолог."
      },
      4: {
        name: "Практичність, стабільність",
        explanation: "Четвірка показує схильність до організації та відповідальності.",
        advice: "Будь дисциплінованим і дотримуйся плану.",
        example: "Приклад: бухгалтер, інженер, менеджер."
      },
      5: {
        name: "Експерименти, свобода",
        explanation: "П’ятірка символізує нові враження та прагнення до свободи.",
        advice: "Не бійся змін і розширюй горизонт можливостей.",
        example: "Приклад: мандрівник, журналіст, блогер."
      },
      6: {
        name: "Творчість, турбота про інших",
        explanation: "Шістка у місії вказує на гармонію, підтримку та допомогу близьким.",
        advice: "Допомагай іншим і дбай про гармонію навколо себе.",
        example: "Приклад: вчитель, психолог, дизайнер інтер’єрів."
      },
      7: {
        name: "Дослідження, духовність",
        explanation: "Сімка символізує прагнення до знань і самопізнання.",
        advice: "Приділяй увагу навчанні та розвитку внутрішньої мудрості.",
        example: "Приклад: науковець, філософ, дослідник."
      },
      8: {
        name: "Матеріальний успіх, амбіції",
        explanation: "Вісімка символізує кар’єрний ріст і досягнення матеріальних цілей.",
        advice: "Робота і наполегливість принесуть результати.",
        example: "Приклад: бізнесмен, управлінець."
      },
      9: {
        name: "Допомога іншим, служіння",
        explanation: "Дев’ятка вказує на потребу підтримки інших та духовне служіння.",
        advice: "Будь корисним для людей і суспільства.",
        example: "Приклад: лікар, наставник, волонтер."
      }
    };


  constructor() { }

  /** Підсумовує всі цифри числа */
  digitSum(num: number): number {
    return num.toString().split('').reduce((a, b) => a + parseInt(b, 10), 0);
  }

  /** Зводить число до однозначного (1–9) */
  reduceToOneDigit(num: number): number {
    let n = num;
    while (n > 9) n = this.digitSum(n);
    return n;
  }

  /** Розрахунок числа свідомості (Conscious Number) */
  calculateConscious(birthDay: number): number {
    // Традиційно число свідомості = день народження зведений до 1 цифри
    return this.reduceToOneDigit(birthDay);
  }

  /** Розрахунок числа місії (Mission Number) */
  calculateMission(birthDay: number, birthMonth: number, birthYear: number): number {
    // Згідно системи: сума цифр дати народження, потім зведення до однозначного
    const sum = this.digitSum(birthDay) + this.digitSum(birthMonth) + this.digitSum(birthYear);
    return this.reduceToOneDigit(sum);
  }

  /** Розрахунок особистого року (Personal Year) */
  calculatePersonalYear(birthDay: number, birthMonth: number, year: number): number {
    // Особистий рік = день + місяць + рік прогнозу
    const sum = this.digitSum(birthDay) + this.digitSum(birthMonth) + this.digitSum(year);
    return this.reduceToOneDigit(sum);
  }

  /** Розрахунок числа імені (Final Name Digit) */
  calculateFinalDigit(name: string): number {
    const upper = name.toUpperCase().replace(/[^A-Z]/g, '');
    let sum = 0;
    for (let ch of upper) {
      if (this.syucaiMap[ch]) sum += this.syucaiMap[ch];
    }
    return this.reduceToOneDigit(sum);
  }

  /** Повертає значення по фінальній цифрі імені */
  getMeaning(finalDigit: number): { name: string; advice: string; explanation: string; example: string } {
    return this.meanings[finalDigit] || {
      name: '',
      advice: '',
      explanation: '',
      example: ''
    };
  }

}
